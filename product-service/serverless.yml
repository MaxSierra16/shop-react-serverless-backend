service: product

frameworkVersion: '3'

plugins:
  - serverless-plugin-typescript
  - serverless-dotenv-plugin
  - serverless-plugin-include-dependencies

package:
  excludeDevDependencies: false

provider:
  name: aws
  runtime: nodejs16.x

resources:
  Resources:
    catalogItemsQueue:
      Type: 'AWS::SQS::Queue'
      # Properties:
      #   QueueName: 'catalogItemsQueue'

functions:
  getProductsList:
    handler: src/functions/getProductsList.handler
    events:
      - httpApi:
          path: '/product'
          method: 'GET'
          cors: true

  getProductsById:
    handler: src/functions/getProductsById.handler
    events:
      - httpApi:
          path: '/product/{id}'
          method: 'GET'
          cors: true

  createProduct:
    handler: src/functions/createProduct.handler
    events:
      - httpApi:
          path: '/product'
          method: 'POST'
          cors: true

  catalogBatchProcess:
    handler: src/functions/catalogBatchProcess.handler
    events:
      - sqs:
          arn:
            Fn::GetAtt:
              - catalogItemsQueue
              - Arn
          # arn: arn:aws:sqs:us-east-1:864208721353:TestQueue
          batchSize: 5
